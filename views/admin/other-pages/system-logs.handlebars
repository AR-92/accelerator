<!-- System Logs Content -->
<div class="max-w-7xl mx-auto rounded-xl overflow-hidden flex flex-col mx-4 my-4">

   <!-- Page Header -->
   {{> page-header title="System Logs" description="View and search system application logs" border=true}}

   <div class="p-6 space-y-6">
      {{#if error}}
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
         <div class="flex">
            <div class="flex-shrink-0">
               {{{icon 'alert-triangle' size='20' class='text-red-400'}}}
            </div>
            <div class="ml-3">
               <h3 class="text-sm font-medium text-red-800">Logs Error</h3>
               <div class="mt-2 text-sm text-red-700">
                  <p>{{error}}</p>
               </div>
            </div>
         </div>
      </div>
      {{/if}}

      <!-- Filters -->
      <div class="bg-card rounded-lg border border-border p-6">
         <form method="GET" class="flex flex-wrap gap-4 items-end">
            <div class="flex-1 min-w-0">
               <label class="block text-sm font-medium text-card-foreground mb-2">Search Logs</label>
               <input type="text" name="search" value="{{filters.search}}"
                      placeholder="Search log messages..."
                      class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="w-48">
               <label class="block text-sm font-medium text-card-foreground mb-2">Log Level</label>
               <select name="level" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="all" {{#eq filters.level 'all'}}selected{{/eq}}>All Levels</option>
                  <option value="error" {{#eq filters.level 'error'}}selected{{/eq}}>Errors</option>
                  <option value="warn" {{#eq filters.level 'warn'}}selected{{/eq}}>Warnings</option>
                  <option value="info" {{#eq filters.level 'info'}}selected{{/eq}}>Info</option>
                  <option value="debug" {{#eq filters.level 'debug'}}selected{{/eq}}>Debug</option>
               </select>
            </div>
            <div class="w-48">
               <label class="block text-sm font-medium text-card-foreground mb-2">Date</label>
               <select name="date" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">All Dates</option>
                  {{#each availableDates}}
                  <option value="{{this}}" {{#eq ../filters.date this}}selected{{/eq}}>{{this}}</option>
                  {{/each}}
               </select>
            </div>
            <div class="flex gap-2">
               <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                  {{{icon 'search' size='16' class='mr-2'}}}
                  Filter
               </button>
               <a href="/admin/other-pages/system-logs" class="px-4 py-2 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors border border-gray-200">
                  {{{icon 'x' size='16' class='mr-2'}}}
                  Clear
               </a>
            </div>
         </form>
      </div>

      <!-- Logs Display -->
      {{#if hasLogs}}
      <div class="bg-card rounded-lg border border-border">
         <div class="p-6 border-b border-border flex items-center justify-between">
            <div>
               <h3 class="text-lg font-semibold text-card-foreground">Log Entries</h3>
               <p class="text-sm text-muted-foreground mt-1">
                  Showing {{logs.length}} of {{totalLogs}} log entries
                  {{#if filters.search}} matching "{{filters.search}}"{{/if}}
               </p>
            </div>
            <button id="export-logs-btn" class="px-4 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors border border-green-200">
               {{{icon 'download' size='16' class='mr-2'}}}
               Export Logs
            </button>
         </div>

         <div class="divide-y divide-border">
            {{#each logs}}
            <div class="p-4 hover:bg-muted/50 transition-colors">
               <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0">
                     <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                          {{#eq level 'error'}}bg-red-100 text-red-800{{/eq}}
                          {{#eq level 'warn'}}bg-yellow-100 text-yellow-800{{/eq}}
                          {{#eq level 'info'}}bg-blue-100 text-blue-800{{/eq}}
                          {{#eq level 'debug'}}bg-gray-100 text-gray-800{{/eq}}">
                          {{{icon 'circle' size='8' class='mr-1'}}}
                          {{level}}
                        </span>
                        <span class="text-sm text-muted-foreground font-mono">{{timestamp}}</span>
                        <span class="text-sm text-muted-foreground">{{source}}</span>
                     </div>
                     <p class="text-sm text-card-foreground break-words">{{message}}</p>
                  </div>
               </div>
            </div>
            {{/each}}
         </div>

         <!-- Pagination -->
         {{#if (gt totalPages 1)}}
         <div class="px-6 py-4 border-t border-border flex items-center justify-between">
            <div class="text-sm text-muted-foreground">
               Page {{currentPage}} of {{totalPages}}
            </div>
            <div class="flex gap-2">
               {{#if (gt currentPage 1)}}
               <a href="?page={{subtract currentPage 1}}&level={{filters.level}}&date={{filters.date}}&search={{filters.search}}"
                  class="px-3 py-1 bg-gray-50 text-gray-700 rounded hover:bg-gray-100 border border-gray-200">
                  Previous
               </a>
               {{/if}}

               {{#if (lt currentPage totalPages)}}
               <a href="?page={{add currentPage 1}}&level={{filters.level}}&date={{filters.date}}&search={{filters.search}}"
                  class="px-3 py-1 bg-gray-50 text-gray-700 rounded hover:bg-gray-100 border border-gray-200">
                  Next
               </a>
               {{/if}}
            </div>
         </div>
         {{/if}}
      </div>
      {{else}}
      <div class="bg-card rounded-lg border border-border p-12">
         <div class="text-center">
            <div class="w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4">
               {{{icon 'file-text' size='32' class='text-muted-foreground'}}}
            </div>
            <h3 class="text-lg font-medium text-card-foreground mb-2">No Logs Found</h3>
            <p class="text-muted-foreground">
               {{#if filters.search}}
               No log entries match your search criteria.
               {{else}}
               No log files were found or logs are not available.
               {{/if}}
            </p>
            {{#if filters.search}}
            <a href="/admin/other-pages/system-logs" class="text-blue-600 hover:text-blue-800 mt-4 inline-block">
               Clear filters
            </a>
            {{/if}}
         </div>
      </div>
      {{/if}}
   </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
   // Export logs functionality
   const exportBtn = document.getElementById('export-logs-btn');
   if (exportBtn) {
      exportBtn.addEventListener('click', function() {
         // Create a simple text export of visible logs
         const logs = document.querySelectorAll('.divide-y > div');
         let logText = 'System Logs Export\n';
         logText += '=' .repeat(50) + '\n\n';

         logs.forEach(log => {
            const level = log.querySelector('.rounded-full')?.textContent.trim() || '';
            const timestamp = log.querySelector('.font-mono')?.textContent.trim() || '';
            const message = log.querySelector('p:last-child')?.textContent.trim() || '';

            logText += `[${timestamp}] ${level.toUpperCase()}: ${message}\n`;
         });

         // Download as text file
         const blob = new Blob([logText], { type: 'text/plain' });
         const url = window.URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `system-logs-${new Date().toISOString().split('T')[0]}.txt`;
         document.body.appendChild(a);
         a.click();
         window.URL.revokeObjectURL(url);
         document.body.removeChild(a);
      });
   }
});
</script>