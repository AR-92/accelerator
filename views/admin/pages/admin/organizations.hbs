<div class='flex flex-col gap-4 lg:gap-6'>
    <!-- Header -->
    <div class='flex items-center justify-between'>
      <div class='grid gap-1'>
        <h1 class='font-heading text-2xl font-semibold text-foreground dark:text-white'>Organization Management</h1>
        <p class='text-base text-black dark:text-white'>Total organizations: {{pagination.total}}</p>
      </div>
      <div class='flex gap-2'>
         <button onclick="exportToCSV()" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2'>
           {{lucide 'Download' 'w-4 h-4 mr-2'}}
           Export CSV
         </button>
         <button onclick="openCreateOrganizationModal()" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2'>
           {{lucide 'Plus' 'w-4 h-4 mr-2'}}
           Create Organization
         </button>
      </div>
    </div>

   <!-- Stats Cards -->
   <div class='grid gap-4 md:grid-cols-2 lg:grid-cols-4'>
     <div class='rounded-lg border bg-card text-card-foreground shadow-sm p-6'>
       <div class='flex flex-row items-center justify-between space-y-0 pb-2'>
         <h3 class='tracking-tight text-sm font-medium'>Total Organizations</h3>
         {{lucide 'Building2' 'h-4 w-4 text-black dark:text-white'}}
       </div>
       <div class='text-2xl font-bold'>{{stats.totalOrganizations}}</div>
     </div>
     <div class='rounded-lg border bg-card text-card-foreground shadow-sm p-6'>
       <div class='flex flex-row items-center justify-between space-y-0 pb-2'>
         <h3 class='tracking-tight text-sm font-medium'>Corporates</h3>
         {{lucide 'Building' 'h-4 w-4 text-black dark:text-white'}}
       </div>
       <div class='text-2xl font-bold'>{{stats.corporateCount}}</div>
     </div>
     <div class='rounded-lg border bg-card text-card-foreground shadow-sm p-6'>
       <div class='flex flex-row items-center justify-between space-y-0 pb-2'>
         <h3 class='tracking-tight text-sm font-medium'>Enterprises</h3>
         {{lucide 'Factory' 'h-4 w-4 text-black dark:text-white'}}
       </div>
       <div class='text-2xl font-bold'>{{stats.enterpriseCount}}</div>
     </div>
     <div class='rounded-lg border bg-card text-card-foreground shadow-sm p-6'>
       <div class='flex flex-row items-center justify-between space-y-0 pb-2'>
         <h3 class='tracking-tight text-sm font-medium'>Startups</h3>
         {{lucide 'Rocket' 'h-4 w-4 text-black dark:text-white'}}
       </div>
       <div class='text-2xl font-bold'>{{stats.startupCount}}</div>
     </div>
   </div>

<!-- Glass card container -->
 <div
  class="w-full rounded-xl shadow-2xl overflow-hidden bg-white/85 backdrop-blur-sm ring-1 ring-gray-200 flex flex-col min-h-[600px]">

  <!-- Sticky header (toolbar) -->
   <header class="sticky top-0 z-20 bg-yellow-800 text-white p-5">
    <!-- Page Title and Description -->
    <div class="mb-6 flex justify-between">

    <div class="text-left">
      <h1 class="text-3xl font-bold text-white mb-2">Organizations</h1>
      <p class=" text-gray-200">Manage and oversee all organizations</p>
    </div>
        <div class="">
          <button onclick="exportToCSV()" class="flex items-center gap-2 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full px-4 py-2 text-sm">
          {{lucide 'Download' 'w-4 h-4'}}
          <span class="text-sm font-medium">Export</span>
        </a>
    </div>
     </div>
     <div class="max-w-7xl mx-auto flex items-center gap-4">
      <!-- center: search and filters -->
      <div class="flex-1 flex justify-left gap-4">
        <div class="w-full max-w-xs">
          <label class="relative block">
            <span class="sr-only">Search</span>
            <span class="absolute inset-y-0 left-3 flex items-center">
              {{lucide 'Search' 'w-5 h-5 text-white/80'}}
            </span>
            <input
              class="w-full pl-12 pr-4 py-1.5 rounded-full bg-white/10 hover:bg-white/20 border border-white/30 placeholder-white/75 text-white focus:outline-none focus:ring-2 focus:ring-white/30"
              placeholder="Search organizations..." aria-label="Search" id="searchInput" />
          </label>
        </div>

        <div class="w-full max-w-xs">
          <label class="relative block">
            <span class="sr-only">Type</span>
            <span class="absolute inset-y-0 left-3 flex items-center">
              {{lucide 'Filter' 'w-5 h-5 text-white/80'}}
            </span>
            <select id="typeFilter" class="w-full pl-12 pr-4 py-1.5 rounded-full bg-white/10 hover:bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/30 appearance-none">
              <option value="" class="text-gray-900">All Types</option>
              <option value="corporate" class="text-gray-900">Corporate</option>
              <option value="enterprise" class="text-gray-900">Enterprise</option>
              <option value="startup" class="text-gray-900">Startup</option>
            </select>
          </label>
        </div>
      </div>

      <!-- right: small action icons -->
      <div class="flex items-center gap-3">
        <button onclick="location.reload()"
          class="p-2 rounded-full bg-white/10 border border-white/25 hover:bg-white/20" title="Refresh">
          {{lucide 'RefreshCw' 'w-5 h-5'}}
        </button>
        <button onclick="openCreateOrganizationModal()"
          class="flex items-center gap-2 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full px-4 py-2 text-sm">
          {{lucide 'Plus' 'w-4 h-4'}}
          <span class="text-sm font-medium">Create</span>
        </button>
      </div>
    </div>
   </header>

    <!-- Organizations Table -->
     <div class='rounded-md bg-card text-card-foreground shadow-sm overflow-visible' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <div class='px-6 py-4 border-b border-border'>
        <h2 class='text-lg font-medium text-foreground'>Organizations ({{pagination.total}})</h2>
      </div>
      <div class='overflow-x-auto'>
        <table class='min-w-full divide-y divide-border table-fixed sm:table-auto'>
          <thead class='bg-yellow-200 dark:bg-yellow-800'>
            <tr>
              <th class='min-w-48 px-4 py-3 text-left text-xs font-medium text-black dark:text-white uppercase tracking-wider'>
                Name
              </th>
              <th class='w-24 px-4 py-3 text-left text-xs font-medium text-black dark:text-white uppercase tracking-wider'>
                Type
              </th>
              <th class='w-24 px-4 py-3 text-left text-xs font-medium text-black dark:text-white uppercase tracking-wider'>
                Owner
              </th>
              <th class='w-32 px-4 py-3 text-left text-xs font-medium text-black dark:text-white uppercase tracking-wider hidden md:table-cell'>
                Created
              </th>
              <th class='w-48 px-4 py-3 text-left text-xs font-medium text-black dark:text-white uppercase tracking-wider'>Actions</th>
            </tr>
          </thead>
           <tbody class='bg-yellow-50 dark:bg-yellow-900 divide-y divide-border'>
             {{#each organizations}}
              <tr class='hover:bg-yellow-100 dark:hover:bg-yellow-800'>
               <td class='w-1/4 px-4 py-4 whitespace-nowrap'>
                <div class='flex items-center gap-3'>
                  {{#if (eq org_type 'corporate')}}
                    {{lucide 'Building' 'h-5 w-5 text-blue-500'}}
                  {{else if (eq org_type 'enterprise')}}
                    {{lucide 'Factory' 'h-5 w-5 text-green-500'}}
                  {{else}}
                    {{lucide 'Rocket' 'h-5 w-5 text-purple-500'}}
                  {{/if}}
                  <div>
                    <div class='text-sm font-medium text-foreground'>{{name}}</div>
                    <div class='text-sm text-black dark:text-white'>ID: {{id}}</div>
                  </div>
                </div>
              </td>
               <td class='w-24 px-4 py-4 whitespace-nowrap'>
                 <span class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                   {{#if (eq org_type 'corporate')}}bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400
                   {{else if (eq org_type 'enterprise')}}bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400
                   {{else}}bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400{{/if}}'>
                   {{capitalize org_type}}
                 </span>
               </td>
               <td class='w-24 px-4 py-4 whitespace-nowrap'>
                 {{#if owner_user_id}}
                   <span class='text-sm text-black dark:text-white'>User #{{owner_user_id}}</span>
                 {{else}}
                   <span class='text-sm text-black dark:text-white'>â€”</span>
                 {{/if}}
               </td>
               <td class='w-32 px-4 py-4 whitespace-nowrap text-sm text-black dark:text-white hidden md:table-cell'>
                 {{formatDate created_at}}
               </td>
               <td class='px-4 py-4 whitespace-nowrap text-sm font-medium'>
                 <div class='flex items-center gap-2'>
                   <a href='/admin/organizations/{{id}}' class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-8 w-8'>
                     {{lucide 'Eye' 'h-4 w-4'}}
                   </a>
                   <button onclick="editOrganization({{id}})" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-8 w-8'>
                     {{lucide 'Edit' 'h-4 w-4'}}
                   </button>
                   <button onclick="deleteOrganization({{id}})" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-8 w-8 text-destructive hover:bg-destructive hover:text-destructive-foreground'>
                     {{lucide 'Trash2' 'h-4 w-4'}}
                   </button>
                 </div>
               </td>
            </tr>
            {{else}}
            <tr>
              <td colspan="6" class='px-6 py-8 text-center text-gray-500'>
                <div class="text-gray-500">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                  </svg>
                  <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-100">No organizations found</h3>
                  <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Organizations will appear here once they are created.</p>
                </div>
              </td>
            </tr>
            {{/each}}
          </tbody>
       </table>
     </div>

      <!-- Pagination -->
      {{#if pagination.pages}}
      <div class='px-6 py-4 border-t border-border flex items-center justify-between'>
         <div class='text-sm text-black dark:text-white'>
           Showing {{#if organizations.length}}{{add (multiply (subtract pagination.page 1) pagination.limit) 1}}{{else}}0{{/if}}-{{add (multiply (subtract pagination.page 1) pagination.limit) organizations.length}} of {{pagination.total}} organizations
         </div>
        <div class='flex gap-2'>
          {{#if pagination.hasPrev}}
          <a href='?page={{subtract pagination.page 1}}&limit={{pagination.limit}}&search={{filters.search}}&type={{filters.type}}'
             class='px-3 py-1 border border-border rounded-md text-sm hover:bg-muted transition-colors'>Previous</a>
          {{/if}}

          {{#each (range 1 pagination.pages)}}
           {{#if (eq this ../pagination.page)}}
             <span class='px-3 py-1 border border-primary bg-primary/10 text-primary rounded-md text-sm'>
               {{this}}
             </span>
           {{else}}
             <a href='?page={{this}}&limit={{pagination.limit}}&search={{filters.search}}&type={{filters.type}}'
                class='px-3 py-1 border border-border hover:bg-muted rounded-md text-sm transition-colors'>
               {{this}}
             </a>
           {{/if}}
          {{/each}}

          {{#if pagination.hasNext}}
          <a href='?page={{add pagination.page 1}}&limit={{pagination.limit}}&search={{filters.search}}&type={{filters.type}}'
             class='px-3 py-1 border border-border rounded-md text-sm hover:bg-muted transition-colors'>Next</a>
          {{/if}}
        </div>
      </div>
      {{/if}}
    </div>
  </div>

<script>
// Filter functionality - auto-apply on change
document.getElementById('typeFilter').addEventListener('change', function() {
  applyFilters();
});

document.getElementById('searchInput').addEventListener('input', function() {
  // Debounce search input
  clearTimeout(window.searchTimeout);
  window.searchTimeout = setTimeout(applyFilters, 300);
});

function applyFilters() {
  const type = document.getElementById('typeFilter').value;
  const search = document.getElementById('searchInput').value;

  const params = new URLSearchParams(window.location.search);
  if (type) params.set('type', type); else params.delete('type');
  if (search) params.set('search', search); else params.delete('search');
  params.set('page', '1'); // Reset to first page

  window.location.search = params.toString();
}

// Export functionality
function exportToCSV() {
  const params = new URLSearchParams(window.location.search);
  window.location.href = '/admin/organizations/export?' + params.toString();
}

// Organization actions
function openCreateOrganizationModal() {
  // TODO: Implement create organization modal
  alert('Create organization functionality coming soon!');
}

function editOrganization(id) {
  // TODO: Implement edit organization
  alert('Edit organization functionality coming soon!');
}

function deleteOrganization(id) {
  if (confirm('Are you sure you want to delete this organization?')) {
    // TODO: Implement delete organization
    alert('Delete organization functionality coming soon!');
  }
}

// Helper functions for Handlebars
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function formatDate(dateStr) {
  return new Date(dateStr).toLocaleDateString();
}

function range(start, end) {
  const result = [];
  for (let i = start; i <= end; i++) {
    result.push(i);
  }
  return result;
}
</script>