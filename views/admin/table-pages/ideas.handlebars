<!-- Ideas Management Content -->
<div class="max-w-7xl mx-auto rounded-xl overflow-hidden flex flex-col mx-4 my-4">

   <!-- Page Header -->
   <header class="sticky top-0 z-20 text-card-foreground p-5 border-b border-border">
    <!-- Page Title and Description -->
    <div class="mb-6 flex justify-between">

      <div class="text-left">
        <h1 class="text-3xl font-bold text-card-foreground mb-2">Ideas Management</h1>
        <p class="text-muted-foreground">Manage and organize all system ideas efficiently</p>
      </div>

      <!-- Create Idea Button -->
      <div class="flex items-center gap-3">
        <button onclick="openCreateIdeaModal()"
          class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          Create Idea
        </button>
      </div>

    </div>
      <!-- Hidden inputs for current filter values -->
      <input type="hidden" id="currentSearch" name="search" value="{{query.search}}">
      <input type="hidden" id="currentStatus" name="status" value="{{query.status}}">
      <input type="hidden" id="currentLimit" name="limit" value="{{pagination.limit}}">

      <div class="max-w-7xl mx-auto flex items-center gap-4">
       <!-- Search Input -->
       <div class="flex-1 max-w-md">
         <div class="relative">
           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
             <svg class="h-5 w-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
             </svg>
           </div>
            <input type="text" id="searchInput" name="search" value="{{query.search}}" placeholder="Search ideas..."
              class="block w-full pl-10 pr-3 py-2 border border-input rounded-lg bg-background text-card-foreground placeholder-muted-foreground focus:ring-2 focus:ring-primary focus:border-transparent"
              hx-get="/admin/table-pages/ideas" hx-target="#ideasTableContainer" hx-trigger="input changed delay:300ms, search"
              hx-include="[id='currentStatus'],[id='currentLimit']"
              hx-on:htmx:before-request="document.getElementById('currentSearch').value = document.getElementById('searchInput').value">
         </div>
       </div>

       <!-- Status Filter -->
       <div class="flex items-center gap-2">
          <select id="statusFilter" name="status" class="border border-input rounded-lg px-3 py-2 text-sm bg-background shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            hx-get="/admin/table-pages/ideas" hx-target="#ideasTableContainer"
            hx-include="[id='currentSearch'],[id='currentLimit']"
            hx-on:htmx:before-request="document.getElementById('currentStatus').value = document.getElementById('statusFilter').value">
           <option value="">All Status</option>
           <option value="pending" {{#if (eq query.status 'pending')}}selected{{/if}}>Pending</option>
           <option value="approved" {{#if (eq query.status 'approved')}}selected{{/if}}>Approved</option>
           <option value="rejected" {{#if (eq query.status 'rejected')}}selected{{/if}}>Rejected</option>
           <option value="active" {{#if (eq query.status 'active')}}selected{{/if}}>Active</option>
           <option value="draft" {{#if (eq query.status 'draft')}}selected{{/if}}>Draft</option>
         </select>
       </div>
     </div>
    </header>

    {{> table}}
  </div>

   <!-- Create Idea Modal -->
   <div id="createIdeaModal" data-modal-backdrop class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" role="dialog" aria-hidden="true">
     <div class="bg-card p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
       <h3 class="text-lg font-semibold mb-4 text-card-foreground">Create New Idea</h3>
       <form hx-post="/api/ideas" hx-target="#ideasTableContainer" hx-swap="beforeend" hx-on:htmx:after-request="closeCreateIdeaModal()">
         <div class="mb-4">
           <label for="ideaTitle" class="block text-sm font-medium text-card-foreground mb-2">Title</label>
           <input type="text" id="ideaTitle" name="title" required class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
         </div>
         <div class="mb-4">
           <label for="ideaDescription" class="block text-sm font-medium text-card-foreground mb-2">Description</label>
           <textarea id="ideaDescription" name="description" rows="3" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
         </div>
         <div class="mb-4">
           <label for="ideaUserId" class="block text-sm font-medium text-card-foreground mb-2">User ID</label>
           <input type="number" id="ideaUserId" name="user_id" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
         </div>
         <div class="mb-4">
           <label for="ideaType" class="block text-sm font-medium text-card-foreground mb-2">Type</label>
           <select id="ideaType" name="type" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
             <option value="">Select type</option>
             <option value="product">Product</option>
             <option value="service">Service</option>
             <option value="app">App</option>
             <option value="platform">Platform</option>
             <option value="tool">Tool</option>
             <option value="other">Other</option>
           </select>
         </div>
         <div class="flex justify-end gap-2">
           <button type="button" data-modal-close class="px-4 py-2 text-sm font-medium text-muted-foreground hover:bg-accent rounded-md">Cancel</button>
           <button type="submit" class="px-4 py-2 text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Create Idea</button>
         </div>
       </form>
     </div>
   </div>

   <!-- Edit Idea Modal -->
   <div id="editIdeaModal" data-modal-backdrop class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" role="dialog" aria-hidden="true">
     <div class="bg-card p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
       <h3 class="text-lg font-semibold mb-4 text-card-foreground">Edit Idea</h3>
       <form hx-put="javascript:getEditUrl()" hx-target="#ideasTableContainer" hx-swap="beforeend" hx-on:htmx:after-request="closeEditIdeaModal()">
         <input type="hidden" id="editIdeaId" name="id">
         <div class="mb-4">
           <label for="editIdeaTitle" class="block text-sm font-medium text-card-foreground mb-2">Title</label>
           <input type="text" id="editIdeaTitle" name="title" required class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
         </div>
         <div class="mb-4">
           <label for="editIdeaDescription" class="block text-sm font-medium text-card-foreground mb-2">Description</label>
           <textarea id="editIdeaDescription" name="description" rows="3" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
         </div>
         <div class="mb-4">
           <label for="editIdeaUserId" class="block text-sm font-medium text-card-foreground mb-2">User ID</label>
           <input type="number" id="editIdeaUserId" name="user_id" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
         </div>
         <div class="mb-4">
           <label for="editIdeaType" class="block text-sm font-medium text-card-foreground mb-2">Type</label>
           <select id="editIdeaType" name="type" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
             <option value="">Select type</option>
             <option value="product">Product</option>
             <option value="service">Service</option>
             <option value="app">App</option>
             <option value="platform">Platform</option>
             <option value="tool">Tool</option>
             <option value="other">Other</option>
           </select>
         </div>
         <div class="mb-4">
           <label for="editIdeaStatus" class="block text-sm font-medium text-card-foreground mb-2">Status</label>
           <select id="editIdeaStatus" name="status" class="w-full px-3 py-2 border border-input rounded-md bg-background text-card-foreground focus:ring-2 focus:ring-primary focus:border-transparent">
             <option value="draft">Draft</option>
             <option value="pending">Pending</option>
             <option value="active">Active</option>
             <option value="approved">Approved</option>
             <option value="rejected">Rejected</option>
             <option value="archived">Archived</option>
           </select>
         </div>
         <div class="flex justify-end gap-2">
           <button type="button" data-modal-close class="px-4 py-2 text-sm font-medium text-muted-foreground hover:bg-accent rounded-md">Cancel</button>
           <button type="submit" class="px-4 py-2 text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Update Idea</button>
         </div>
       </form>
     </div>
   </div>

  {{!-- these are the filter links for the table --}}
  <div id="ideas-filter-links" class="hidden" _="on load set #filter-links.innerHTML to #ideas-filter-links.innerHTML">

  <!-- Include ideas JavaScript -->
  <script src="/js/ideas.js"></script>

  <!-- Script to sync hidden inputs and update filter states -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Sync hidden inputs with current values
      const searchInput = document.getElementById('searchInput');
      const statusFilter = document.getElementById('statusFilter');
      const rowsPerPage = document.getElementById('rowsPerPage-ideas');

      function updateHiddenInputs() {
        document.getElementById('currentSearch').value = searchInput?.value || '';
        document.getElementById('currentStatus').value = statusFilter?.value || '';
        document.getElementById('currentLimit').value = rowsPerPage?.value || '10';
      }

      // Update on input changes
      searchInput?.addEventListener('input', updateHiddenInputs);
      statusFilter?.addEventListener('change', updateHiddenInputs);
      rowsPerPage?.addEventListener('change', updateHiddenInputs);

      // Initial sync
      updateHiddenInputs();
    });

    // Update filter UI after HTMX requests
    document.addEventListener('htmx:afterRequest', function(evt) {
      // Update search input value from hidden input
      const searchInput = document.getElementById('searchInput');
      const currentSearch = document.getElementById('currentSearch');
      if (searchInput && currentSearch) {
        searchInput.value = currentSearch.value;
      }

      // Update status filter value from hidden input
      const statusFilter = document.getElementById('statusFilter');
      const currentStatus = document.getElementById('currentStatus');
      if (statusFilter && currentStatus) {
        statusFilter.value = currentStatus.value;
      }

      // Update rows per page value from hidden input
      const rowsPerPage = document.getElementById('rowsPerPage-ideas');
      const currentLimit = document.getElementById('currentLimit');
      if (rowsPerPage && currentLimit) {
        rowsPerPage.value = currentLimit.value;
      }
    });
  </script>
   <div class="flex flex-col items-center justify-center group">
     <div class="border-t-4 border-primary w-6 rounded-full opacity-100 group-hover:opacity-100"></div>
     <a id="all-ideas-btn" href="/admin/table-pages/ideas" hx-get="/admin/table-pages/ideas" hx-target="#ideasTableContainer" class="text-foreground font-medium text-xs leading-[2.5] group-hover:text-foreground hover:text-foreground group-hover:font-medium hover:font-medium">All Ideas</a>
   </div>
   <div class="flex flex-col items-center justify-center group">
     <div class="border-t-4 border-primary w-6 rounded-full opacity-0 group-hover:opacity-100"></div>
     <a id="pending-ideas-btn" href="/admin/table-pages/ideas?status=pending" hx-get="/admin/table-pages/ideas?status=pending" hx-target="#ideasTableContainer" class="text-muted-foreground text-xs leading-[2.5] group-hover:text-foreground hover:text-foreground group-hover:font-medium hover:font-medium">Pending</a>
   </div>
   <div class="flex flex-col items-center justify-center group">
     <div class="border-t-4 border-primary w-6 rounded-full opacity-0 group-hover:opacity-100"></div>
     <a id="approved-ideas-btn" href="/admin/table-pages/ideas?status=approved" hx-get="/admin/table-pages/ideas?status=approved" hx-target="#ideasTableContainer" class="text-muted-foreground text-xs leading-[2.5] group-hover:text-foreground hover:text-foreground group-hover:font-medium hover:font-medium">Approved</a>
   </div>
   <div class="flex flex-col items-center justify-center group">
     <div class="border-t-4 border-primary w-6 rounded-full opacity-0 group-hover:opacity-100"></div>
     <a id="rejected-ideas-btn" href="/admin/table-pages/ideas?status=rejected" hx-get="/admin/table-pages/ideas?status=rejected" hx-target="#ideasTableContainer" class="text-muted-foreground text-xs leading-[2.5] group-hover:text-foreground hover:text-foreground group-hover:font-medium hover:font-medium">Rejected</a>
   </div>
 </div>