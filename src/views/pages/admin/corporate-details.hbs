<div class='container mx-auto px-4 py-8 max-w-7xl'>
  <!-- Header -->
  <div class='flex items-center justify-between'>
    <div class='grid gap-1'>
      <h1 class='font-heading text-2xl font-semibold text-foreground dark:text-white'>Corporate Details</h1>
      <p class='text-base text-muted-foreground'>{{corporate.name}} ({{corporate.industry}})</p>
    </div>
    <div class='flex gap-2'>
      <button onclick="window.history.back()" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2'>
        ‚Üê Back to Corporates
      </button>
    </div>
  </div>

  <!-- Corporate Info Cards -->
  <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>
    <!-- Basic Information -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Basic Information</h3>
      <div class='space-y-3'>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Name</label>
          <p class='text-sm text-foreground'>{{corporate.name}}</p>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Industry</label>
          <p class='text-sm text-foreground'>{{corporate.industry}}</p>
        </div>
        {{#if corporate.sector}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Sector</label>
          <p class='text-sm text-foreground'>{{corporate.sector}}</p>
        </div>
        {{/if}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Company Size</label>
          <span class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{#if (eq corporate.companySize 'small')}}bg-blue-100 text-blue-800{{else if (eq corporate.companySize 'medium')}}bg-green-100 text-green-800{{else if (eq corporate.companySize 'large')}}bg-yellow-100 text-yellow-800{{else}}bg-purple-100 text-purple-800{{/if}}'>
            {{corporate.companySize}}
          </span>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Status</label>
          <span class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{#if (eq corporate.status 'active')}}bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400{{else if (eq corporate.status 'inactive')}}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400{{else if (eq corporate.status 'acquired')}}bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400{{else}}bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400{{/if}}'>
            {{corporate.status}}
          </span>
        </div>
        {{#if corporate.website}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Website</label>
          <a href="{{corporate.website}}" target="_blank" class='text-sm text-blue-600 hover:text-blue-800'>{{corporate.website}}</a>
        </div>
        {{/if}}
      </div>
    </div>

    <!-- Business Details -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Business Details</h3>
      <div class='space-y-3'>
        {{#if corporate.description}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Description</label>
          <p class='text-sm text-foreground'>{{corporate.description}}</p>
        </div>
        {{/if}}
        {{#if corporate.headquarters}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Headquarters</label>
          <p class='text-sm text-foreground'>{{corporate.headquarters}}</p>
        </div>
        {{/if}}
        {{#if corporate.employeeCount}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Employee Count</label>
          <p class='text-sm text-foreground'>{{corporate.employeeCount}}</p>
        </div>
        {{/if}}
        {{#if corporate.foundedDate}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Founded Date</label>
          <p class='text-sm text-foreground' id="foundedDate">{{corporate.foundedDate}}</p>
        </div>
        {{/if}}
        {{#if corporate.location}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Location</label>
          <p class='text-sm text-foreground'>{{corporate.location}}</p>
        </div>
        {{/if}}
        {{#if corporate.revenue}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Revenue</label>
          <p class='text-sm text-foreground'>${{corporate.revenue}}</p>
        </div>
        {{/if}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>User ID</label>
          <p class='text-sm text-foreground'>{{corporate.userId}}</p>
        </div>
      </div>
    </div>

    <!-- Timestamps -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Timestamps</h3>
      <div class='space-y-3'>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Created</label>
          <p class='text-sm text-foreground' id="createdAt">{{corporate.createdAt}}</p>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Last Updated</label>
          <p class='text-sm text-foreground' id="updatedAt">{{corporate.updatedAt}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
    <h3 class='text-lg font-medium text-foreground mb-4'>Quick Actions</h3>
    <div class='flex flex-wrap gap-2'>
      <button onclick="editCorporate({{corporate.id}})" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2'>
        Edit Corporate
      </button>
      <button onclick="deleteCorporate({{corporate.id}}, '{{corporate.name}}')" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground shadow hover:bg-destructive/90 h-9 px-4 py-2'>
        Delete Corporate
      </button>
    </div>
  </div>
</div>

<!-- Edit Corporate Modal -->
<div id="editCorporateModal" class="fixed inset-0 bg-background/80 backdrop-blur-sm overflow-y-auto h-full w-full hidden">
  <div class="relative top-20 mx-auto p-5 border border-border w-96 shadow-lg rounded-md bg-card">
    <div class="mt-3">
      <h3 class="text-lg font-medium text-foreground mb-4">Edit Corporate</h3>
      <form id="editCorporateForm">
        <input type="hidden" id="editCorporateId">
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Name</label>
          <input type="text" id="editCorporateName" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Industry</label>
          <input type="text" id="editCorporateIndustry" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Sector</label>
          <input type="text" id="editCorporateSector" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Company Size</label>
          <select id="editCorporateCompanySize" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
            <option value="enterprise">Enterprise</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Status</label>
          <select id="editCorporateStatus" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="acquired">Acquired</option>
            <option value="failed">Failed</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Headquarters</label>
          <input type="text" id="editCorporateHeadquarters" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Employee Count</label>
          <input type="number" id="editCorporateEmployeeCount" min="0" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Description</label>
          <textarea id="editCorporateDescription" rows="3" class="flex min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"></textarea>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Website</label>
          <input type="url" id="editCorporateWebsite" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Location</label>
          <input type="text" id="editCorporateLocation" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Revenue</label>
          <input type="number" id="editCorporateRevenue" min="0" step="0.01" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Founded Date</label>
          <input type="date" id="editCorporateFoundedDate" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditCorporateModal()" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2">Cancel</button>
          <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Helper functions for date formatting
function formatDate(dateString) {
  if (!dateString) return '';
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Format dates on page load
document.addEventListener('DOMContentLoaded', function() {
  const createdAtEl = document.getElementById('createdAt');
  const updatedAtEl = document.getElementById('updatedAt');
  const foundedDateEl = document.getElementById('foundedDate');

  if (createdAtEl && createdAtEl.textContent) {
    createdAtEl.textContent = formatDate(createdAtEl.textContent.trim());
  }
  if (updatedAtEl && updatedAtEl.textContent) {
    updatedAtEl.textContent = formatDate(updatedAtEl.textContent.trim());
  }
  if (foundedDateEl && foundedDateEl.textContent) {
    foundedDateEl.textContent = formatDate(foundedDateEl.textContent.trim());
  }
});

// Modal functions
function editCorporate(corporateId) {
  // Fetch corporate data and populate modal
  fetch(`/admin/api/corporates/${corporateId}`)
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById('editCorporateId').value = data.corporate.id;
        document.getElementById('editCorporateName').value = data.corporate.name;
        document.getElementById('editCorporateIndustry').value = data.corporate.industry;
        document.getElementById('editCorporateSector').value = data.corporate.sector || '';
        document.getElementById('editCorporateCompanySize').value = data.corporate.companySize;
        document.getElementById('editCorporateStatus').value = data.corporate.status;
        document.getElementById('editCorporateHeadquarters').value = data.corporate.headquarters || '';
        document.getElementById('editCorporateEmployeeCount').value = data.corporate.employeeCount || '';
        document.getElementById('editCorporateDescription').value = data.corporate.description || '';
        document.getElementById('editCorporateWebsite').value = data.corporate.website || '';
        document.getElementById('editCorporateLocation').value = data.corporate.location || '';
        document.getElementById('editCorporateRevenue').value = data.corporate.revenue || '';
        document.getElementById('editCorporateFoundedDate').value = data.corporate.foundedDate || '';
        document.getElementById('editCorporateModal').classList.remove('hidden');
      }
    });
}

function closeEditCorporateModal() {
  document.getElementById('editCorporateModal').classList.add('hidden');
}

 function deleteCorporate(corporateId, corporateName) {
   Toast.warning(`Are you sure you want to delete corporate "${corporateName}"? This action cannot be undone.`);
   fetch(`/admin/api/corporates/${corporateId}`, {
     method: 'DELETE',
     headers: {
       'Content-Type': 'application/json',
     },
   })
   .then(response => response.json())
   .then(data => {
     if (data.success) {
       window.location.href = '/admin/corporates';
     } else {
       Toast.error('Error deleting corporate: ' + data.error);
     }
   });
 }

// Form handler
document.getElementById('editCorporateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const corporateId = document.getElementById('editCorporateId').value;
  const name = document.getElementById('editCorporateName').value;
  const industry = document.getElementById('editCorporateIndustry').value;
  const sector = document.getElementById('editCorporateSector').value;
  const companySize = document.getElementById('editCorporateCompanySize').value;
  const status = document.getElementById('editCorporateStatus').value;
  const headquarters = document.getElementById('editCorporateHeadquarters').value;
  const employeeCount = document.getElementById('editCorporateEmployeeCount').value;
  const description = document.getElementById('editCorporateDescription').value;
  const website = document.getElementById('editCorporateWebsite').value;
  const location = document.getElementById('editCorporateLocation').value;
  const revenue = document.getElementById('editCorporateRevenue').value;
  const foundedDate = document.getElementById('editCorporateFoundedDate').value;

  fetch(`/admin/api/corporates/${corporateId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      name,
      industry,
      sector,
      companySize,
      status,
      headquarters,
      employeeCount: employeeCount ? parseInt(employeeCount) : null,
      description,
      website,
      location,
      revenue: revenue ? parseFloat(revenue) : null,
      foundedDate
    }),
  })
  .then(response => response.json())
   .then(data => {
     if (data.success) {
       closeEditCorporateModal();
       location.reload();
     } else {
       Toast.error('Error updating corporate: ' + data.error);
     }
   });
});
</script>