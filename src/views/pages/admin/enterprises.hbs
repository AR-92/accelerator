{{> ui/_data-table
  title="Enterprises Management"
  description="Manage and oversee all enterprises in the system"
  headers=(array
    (hash key="name" label="Name")
    (hash key="owner_name" label="Owner")
    (hash key="industry" label="Industry")
    (hash key="created_at" label="Created" class="hidden md:table-cell")
  )
  rows=enterprises
  showCheckbox=true
  showActions=true
  actions=enterpriseActions
  filterBar=(hash
    searchPlaceholder="Search enterprises..."
    searchValue=filters.search
    actions=(array
      (hash onclick="exportToCSV()" icon="Download" title="Export CSV")
      (hash onclick="location.reload()" icon="RefreshCw" title="Refresh")
    )
  )
  bulkActions=(array
    (hash text="Delete Selected" onclick="bulkDelete()" buttonId="bulkDeleteBtn")
  )
  pagination=pagination
  queryParams=(concat "?search=" filters.search)
}}

<script>
// CRUD operations
function editEnterprise(id) {
  // TODO: Implement edit modal/form
  alert('Edit enterprise functionality coming soon');
}

function deleteEnterprise(id, name) {
  if (confirm(`Are you sure you want to delete "${name}"? This action cannot be undone.`)) {
    fetch(`/admin/api/enterprises/${id}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      } else {
        alert('Error deleting enterprise: ' + data.error);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting enterprise');
    });
  }
}

function bulkDelete() {
  const selectedIds = Array.from(document.querySelectorAll('.rowCheckbox:checked')).map(cb => cb.value);

  if (selectedIds.length === 0) return;

  if (confirm(`Are you sure you want to delete ${selectedIds.length} enterprise${selectedIds.length > 1 ? 's' : ''}? This action cannot be undone.`)) {
    Promise.all(selectedIds.map(id =>
      fetch(`/admin/api/enterprises/${id}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        },
      })
    ))
    .then(responses => Promise.all(responses.map(r => r.json())))
    .then(results => {
      const successCount = results.filter(r => r.success).length;
      if (successCount === selectedIds.length) {
        location.reload();
      } else {
        alert(`Deleted ${successCount} of ${selectedIds.length} enterprises`);
        location.reload();
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting enterprises');
    });
  }
}

function exportToCSV() {
  // TODO: Implement CSV export
  alert('Export functionality coming soon');
}
</script>