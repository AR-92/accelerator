<div class='flex flex-col gap-4 lg:gap-6'>
  <!-- Header -->
  <div class='flex items-center justify-between'>
    <div class='grid gap-1'>
      <h1 class='font-heading text-2xl font-semibold text-foreground dark:text-white'>Enterprise Details</h1>
      <p class='text-base text-muted-foreground'>{{enterprise.name}} ({{enterprise.industry}})</p>
    </div>
    <div class='flex gap-2'>
      <button onclick="window.history.back()" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2'>
        ‚Üê Back to Enterprises
      </button>
    </div>
  </div>

  <!-- Enterprise Info Cards -->
  <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>
    <!-- Basic Information -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Basic Information</h3>
      <div class='space-y-3'>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Name</label>
          <p class='text-sm text-foreground'>{{enterprise.name}}</p>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Industry</label>
          <p class='text-sm text-foreground'>{{enterprise.industry}}</p>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Company Size</label>
          <span class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{#if (eq enterprise.companySize 'small')}}bg-blue-100 text-blue-800{{else if (eq enterprise.companySize 'medium')}}bg-green-100 text-green-800{{else if (eq enterprise.companySize 'large')}}bg-yellow-100 text-yellow-800{{else}}bg-purple-100 text-purple-800{{/if}}'>
            {{enterprise.companySize}}
          </span>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Status</label>
          <span class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{#if (eq enterprise.status 'active')}}bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400{{else if (eq enterprise.status 'inactive')}}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400{{else if (eq enterprise.status 'acquired')}}bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400{{else}}bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400{{/if}}'>
            {{enterprise.status}}
          </span>
        </div>
        {{#if enterprise.website}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Website</label>
          <a href="{{enterprise.website}}" target="_blank" class='text-sm text-blue-600 hover:text-blue-800'>{{enterprise.website}}</a>
        </div>
        {{/if}}
      </div>
    </div>

    <!-- Business Details -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Business Details</h3>
      <div class='space-y-3'>
        {{#if enterprise.description}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Description</label>
          <p class='text-sm text-foreground'>{{enterprise.description}}</p>
        </div>
        {{/if}}
        {{#if enterprise.foundedDate}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Founded Date</label>
          <p class='text-sm text-foreground' id="foundedDate">{{enterprise.foundedDate}}</p>
        </div>
        {{/if}}
        {{#if enterprise.location}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Location</label>
          <p class='text-sm text-foreground'>{{enterprise.location}}</p>
        </div>
        {{/if}}
        {{#if enterprise.revenue}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Revenue</label>
          <p class='text-sm text-foreground'>${{enterprise.revenue}}</p>
        </div>
        {{/if}}
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>User ID</label>
          <p class='text-sm text-foreground'>{{enterprise.userId}}</p>
        </div>
      </div>
    </div>

    <!-- Timestamps -->
    <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
      <h3 class='text-lg font-medium text-foreground mb-4'>Timestamps</h3>
      <div class='space-y-3'>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Created</label>
          <p class='text-sm text-foreground' id="createdAt">{{enterprise.createdAt}}</p>
        </div>
        <div>
          <label class='block text-sm font-medium text-muted-foreground'>Last Updated</label>
          <p class='text-sm text-foreground' id="updatedAt">{{enterprise.updatedAt}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class='rounded-md bg-card text-card-foreground shadow-sm p-6' style='box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 2px 0px;'>
    <h3 class='text-lg font-medium text-foreground mb-4'>Quick Actions</h3>
    <div class='flex flex-wrap gap-2'>
      <button onclick="editEnterprise({{enterprise.id}})" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2'>
        Edit Enterprise
      </button>
      <button onclick="deleteEnterprise({{enterprise.id}}, '{{enterprise.name}}')" class='inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground shadow hover:bg-destructive/90 h-9 px-4 py-2'>
        Delete Enterprise
      </button>
    </div>
  </div>
</div>

<!-- Edit Enterprise Modal -->
<div id="editEnterpriseModal" class="fixed inset-0 bg-background/80 backdrop-blur-sm overflow-y-auto h-full w-full hidden">
  <div class="relative top-20 mx-auto p-5 border border-border w-96 shadow-lg rounded-md bg-card">
    <div class="mt-3">
      <h3 class="text-lg font-medium text-foreground mb-4">Edit Enterprise</h3>
      <form id="editEnterpriseForm">
        <input type="hidden" id="editEnterpriseId">
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Name</label>
          <input type="text" id="editEnterpriseName" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Industry</label>
          <input type="text" id="editEnterpriseIndustry" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Company Size</label>
          <select id="editEnterpriseCompanySize" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
            <option value="enterprise">Enterprise</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Status</label>
          <select id="editEnterpriseStatus" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="acquired">Acquired</option>
            <option value="failed">Failed</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Description</label>
          <textarea id="editEnterpriseDescription" rows="3" class="flex min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"></textarea>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Website</label>
          <input type="url" id="editEnterpriseWebsite" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Location</label>
          <input type="text" id="editEnterpriseLocation" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Revenue</label>
          <input type="number" id="editEnterpriseRevenue" min="0" step="0.01" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-foreground mb-2">Founded Date</label>
          <input type="date" id="editEnterpriseFoundedDate" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditEnterpriseModal()" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2">Cancel</button>
          <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Helper functions for date formatting
function formatDate(dateString) {
  if (!dateString) return '';
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Format dates on page load
document.addEventListener('DOMContentLoaded', function() {
  const createdAtEl = document.getElementById('createdAt');
  const updatedAtEl = document.getElementById('updatedAt');
  const foundedDateEl = document.getElementById('foundedDate');

  if (createdAtEl && createdAtEl.textContent) {
    createdAtEl.textContent = formatDate(createdAtEl.textContent.trim());
  }
  if (updatedAtEl && updatedAtEl.textContent) {
    updatedAtEl.textContent = formatDate(updatedAtEl.textContent.trim());
  }
  if (foundedDateEl && foundedDateEl.textContent) {
    foundedDateEl.textContent = formatDate(foundedDateEl.textContent.trim());
  }
});

// Modal functions
function editEnterprise(enterpriseId) {
  // Fetch enterprise data and populate modal
  fetch(`/admin/api/enterprises/${enterpriseId}`)
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById('editEnterpriseId').value = data.enterprise.id;
        document.getElementById('editEnterpriseName').value = data.enterprise.name;
        document.getElementById('editEnterpriseIndustry').value = data.enterprise.industry;
        document.getElementById('editEnterpriseCompanySize').value = data.enterprise.companySize;
        document.getElementById('editEnterpriseStatus').value = data.enterprise.status;
        document.getElementById('editEnterpriseDescription').value = data.enterprise.description || '';
        document.getElementById('editEnterpriseWebsite').value = data.enterprise.website || '';
        document.getElementById('editEnterpriseLocation').value = data.enterprise.location || '';
        document.getElementById('editEnterpriseRevenue').value = data.enterprise.revenue || '';
        document.getElementById('editEnterpriseFoundedDate').value = data.enterprise.foundedDate || '';
        document.getElementById('editEnterpriseModal').classList.remove('hidden');
      }
    });
}

function closeEditEnterpriseModal() {
  document.getElementById('editEnterpriseModal').classList.add('hidden');
}

 function deleteEnterprise(enterpriseId, enterpriseName) {
   Toast.warning(`Are you sure you want to delete enterprise "${enterpriseName}"? This action cannot be undone.`);
   fetch(`/admin/api/enterprises/${enterpriseId}`, {
     method: 'DELETE',
     headers: {
       'Content-Type': 'application/json',
     },
   })
   .then(response => response.json())
   .then(data => {
     if (data.success) {
       window.location.href = '/admin/enterprises';
     } else {
       Toast.error('Error deleting enterprise: ' + data.error);
     }
   });
 }

// Form handler
document.getElementById('editEnterpriseForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const enterpriseId = document.getElementById('editEnterpriseId').value;
  const name = document.getElementById('editEnterpriseName').value;
  const industry = document.getElementById('editEnterpriseIndustry').value;
  const companySize = document.getElementById('editEnterpriseCompanySize').value;
  const status = document.getElementById('editEnterpriseStatus').value;
  const description = document.getElementById('editEnterpriseDescription').value;
  const website = document.getElementById('editEnterpriseWebsite').value;
  const location = document.getElementById('editEnterpriseLocation').value;
  const revenue = document.getElementById('editEnterpriseRevenue').value;
  const foundedDate = document.getElementById('editEnterpriseFoundedDate').value;

  fetch(`/admin/api/enterprises/${enterpriseId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      name,
      industry,
      companySize,
      status,
      description,
      website,
      location,
      revenue: revenue ? parseFloat(revenue) : null,
      foundedDate
    }),
  })
  .then(response => response.json())
   .then(data => {
     if (data.success) {
       closeEditEnterpriseModal();
       location.reload();
     } else {
       Toast.error('Error updating enterprise: ' + data.error);
     }
   });
});
</script>